{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Plan Output Schema",
  "description": "Output structure from Smart Plan agent containing goal, steps, and update proposals",
  "type": "object",
  "required": ["version", "plan_id", "goal", "steps", "timestamp"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version for compatibility tracking",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "examples": ["1.0.0"]
    },
    "plan_id": {
      "type": "string",
      "description": "Unique identifier for this plan (UUID or timestamp-based)",
      "examples": ["plan_2025-01-10_14-30-45"]
    },
    "goal": {
      "type": "string",
      "description": "Clear, specific goal after vagueness resolution and clarifications",
      "minLength": 10
    },
    "vagueness_score": {
      "type": "number",
      "description": "Vagueness score (0-1) that triggered QA if >0.7",
      "minimum": 0,
      "maximum": 1
    },
    "qa_conducted": {
      "type": "boolean",
      "description": "Whether QA survey was generated and responses received"
    },
    "qa_responses": {
      "type": "object",
      "description": "User responses from QA survey if conducted",
      "properties": {
        "ai_improvement_feedback": {
          "type": "string",
          "description": "Response to Question 1: How AI can work better"
        },
        "question_responses": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "question_text": {"type": "string"},
              "selected_option": {
                "type": "string",
                "enum": ["A", "B", "C", "D"]
              },
              "custom_response": {
                "type": "string",
                "description": "Detailed response if option D (Other) selected"
              },
              "additional_context": {"type": "string"}
            }
          }
        }
      }
    },
    "context_gathered": {
      "type": "object",
      "description": "Context sources used during planning",
      "properties": {
        "files_read": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of file paths read for context"
        },
        "semantic_search_queries": {
          "type": "array",
          "items": {"type": "string"}
        },
        "mcp_memory_queries": {
          "type": "array",
          "items": {"type": "string"}
        },
        "observations_retrieved": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "observation_id": {"type": "string"},
              "relevance_score": {"type": "number"}
            }
          }
        }
      }
    },
    "steps": {
      "type": "array",
      "description": "Ordered list of execution steps",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["step_number", "description", "tools_needed"],
        "properties": {
          "step_number": {
            "type": "integer",
            "minimum": 1
          },
          "description": {
            "type": "string",
            "description": "Clear, specific description of what to do in this step"
          },
          "tools_needed": {
            "type": "array",
            "items": {"type": "string"},
            "description": "MCP tools or file operations needed",
            "examples": [["mcp_mcp_docker_create_task", "file_search"]]
          },
          "expected_outcome": {
            "type": "string",
            "description": "What success looks like for this step"
          },
          "dependencies": {
            "type": "array",
            "items": {"type": "integer"},
            "description": "Step numbers that must complete before this step"
          },
          "estimated_duration": {
            "type": "string",
            "description": "Rough time estimate",
            "examples": ["30 seconds", "2 minutes"]
          }
        }
      }
    },
    "prompt_update_proposals": {
      "type": "array",
      "description": "Proposals to update agent prompts based on analysis",
      "items": {
        "type": "object",
        "required": ["target_agent", "section", "proposed_change", "rationale"],
        "properties": {
          "target_agent": {
            "type": "string",
            "enum": ["Smart Plan.agent.md", "Smart Execute.agent.md", "Smart Review.agent.md", "Full Auto.agent.md"]
          },
          "section": {
            "type": "string",
            "description": "Section name or heading within target agent prompt"
          },
          "proposed_change": {
            "type": "string",
            "description": "Specific text change or addition to make"
          },
          "rationale": {
            "type": "string",
            "description": "Why this change improves the system"
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Confidence in this proposal (0-1)"
          },
          "priority": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"]
          }
        }
      }
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when plan was generated"
    },
    "agent_version": {
      "type": "string",
      "description": "Version of Smart Plan agent that generated this",
      "examples": ["1.0.0"]
    }
  }
}
