# AI Files - Tracking System Documentation

**Purpose:** This directory contains all tracking files, schemas, and supporting documentation for the 4-agent self-updating AI system.

**Last Updated:** 2025-01-10

---

## üìÅ Directory Structure

```
AI Files/
‚îú‚îÄ‚îÄ cycle_metadata.json           # Cycle counter and evaluation tracking
‚îú‚îÄ‚îÄ prompt_edit_log.jsonl         # Immutable audit trail of all prompt edits
‚îú‚îÄ‚îÄ qa_survey_template.md         # Template for user clarification surveys
‚îú‚îÄ‚îÄ schemas/                      # JSON schemas for validation
‚îÇ   ‚îú‚îÄ‚îÄ plan_output.schema.json
‚îÇ   ‚îú‚îÄ‚îÄ execution_state.schema.json
‚îÇ   ‚îú‚îÄ‚îÄ cycle_metadata.schema.json
‚îÇ   ‚îî‚îÄ‚îÄ prompt_edit_log.schema.json
‚îú‚îÄ‚îÄ old_versions/                 # Backups of edited agent prompts
‚îú‚îÄ‚îÄ archive/                      # Completed sessions archived here
‚îî‚îÄ‚îÄ README.md                     # This file
```

---

## üîÑ 4-Agent System Overview

### Agent Responsibilities

1. **Smart Plan.agent.md**
   - Vagueness detection (0-1 scoring)
   - QA survey generation when vagueness >0.7
   - Context gathering (files, semantic search, MCP memory)
   - Plan generation with ordered steps
   - **Proposes** updates to own prompt and other agents
   - Outputs: `plan_output.json`

2. **Smart Execute.agent.md**
   - Loads and executes plan steps
   - Invokes MCP tools and file operations
   - **Edits** Smart Plan, Smart Review, Full Auto prompts (NOT itself)
   - Records observations to MCP memory
   - Outputs: `execution_state.json`, `prompt_edit_log.jsonl`

3. **Smart Review.agent.md**
   - Analyzes execution results and stall detection
   - Root-cause analysis of failures/issues
   - **Edits** Smart Execute prompt (completes update cycle)
   - Proposes replanning if needed
   - Manages cycle counter and 10-cycle evaluations
   - Outputs: `replanning_context.json`, `10_cycle_evaluation_{N}.md`

4. **Full Auto.agent.md**
   - Orchestrates the 3 agents in sequence
   - Validates agent versions at startup
   - Loads agent instructions dynamically via file_search + read_file
   - Manages workflow loop until task completion
   - Prevents infinite loops (max 10 iterations)

### Update Cycle Flow

```
Smart Plan proposes updates
    ‚Üì
Smart Execute edits Plan/Review/FullAuto (not itself)
    ‚Üì
Smart Review edits Execute (completes cycle)
    ‚Üì
All 4 agents now updated
```

**Critical Rule:** Smart Execute NEVER edits Smart Execute.agent.md (prevents self-modification loops)

---

## üìä File Formats

### cycle_metadata.json

Tracks overall cycle count and triggers 10-cycle evaluations.

**Structure:**
- `cycle_count`: Total completed cycles
- `next_evaluation_due`: Cycle number for next evaluation (current + 10)
- `cycle_history`: Last 20 cycles with stats
- `evaluations`: Record of all 10-cycle evaluations

**Updated by:** Smart Review agent at end of each cycle

### prompt_edit_log.jsonl

Immutable append-only log of all prompt edits. Each line is a JSON object conforming to `prompt_edit_log.schema.json`.

**Format:** JSONL (one JSON object per line)

**Fields:**
- `edit_id`: Unique identifier
- `timestamp`: When edit occurred
- `editor_agent`: Who made the edit
- `edited_agent`: Who was edited
- `old_content` / `new_content`: What changed
- `rationale`: Why the edit was made
- `success`: Whether edit succeeded

**Updated by:** Smart Execute and Smart Review agents when editing prompts

**IMPORTANT:** Never modify existing lines - only append new lines!

### plan_output.json

Generated by Smart Plan agent for each new plan.

**Key sections:**
- `goal`: Clarified, specific goal
- `vagueness_score`: Vagueness detection result
- `qa_conducted`: Whether survey was needed
- `steps`: Ordered array of execution steps
- `prompt_update_proposals`: Suggested prompt edits

**Consumed by:** Smart Execute agent

### execution_state.json

Tracks progress through plan execution.

**Key sections:**
- `current_step`: Current step number (0 = not started)
- `status`: Overall status (in-progress/completed/failed/stalled)
- `steps`: Per-step status with timings
- `prompt_edits_executed`: Record of edits made during execution

**Updated by:** Smart Execute agent during execution
**Consumed by:** Smart Review agent for analysis

### qa_survey_template.md

Template for generating clarification surveys when user goal is vague.

**Structure:**
- Question 1: **ALWAYS** "How can the AI work better?"
- Questions 2-5: Contextual based on vagueness type
- Each question has A/B/C/D options with detailed examples
- Option D is always "Other (please specify)" with guided prompts

**Usage:**
1. Smart Plan detects vagueness >0.7
2. Generates survey using this template
3. Presents to user
4. Incorporates responses into plan

---

## üß† MCP Memory Integration

### Primary Storage: MCP Memory

**Use for:**
- Observations and learnings (ephemeral insights)
- Semantic search across historical knowledge
- Cross-session learning and patterns

**Observation Types:**
- `execution_step`: What happened during execution
- `root_cause_analysis`: Why failures occurred
- `prompt_update_proposal`: Suggested improvements
- `cycle_metadata`: Cycle evaluation insights

**Tools:**
- `mcp_mcp_docker_add_observations`: Store new observations
- `mcp_mcp_docker_search_nodes`: Semantic search for relevant insights

### Secondary Storage: Local Files

**Use for:**
- Compliance audit trails (prompt_edit_log.jsonl)
- State persistence (cycle_metadata.json, execution_state.json)
- Structured data that needs versioning
- Official records required for governance

**Why both?**
- MCP memory: Fast semantic queries, automatic deduplication, ephemeral
- Local files: Immutable audit trail, regulatory compliance, version control

---

## üîç 10-Cycle Evaluation System

**Trigger:** Every 10 completed cycles (cycle_count % 10 == 0)

**Process:**
1. Smart Review detects evaluation due
2. Analyzes last 10 cycles for patterns:
   - Common failure modes
   - Tool usage patterns
   - Stall conditions
   - Prompt edit effectiveness
3. Generates evaluation report: `10_cycle_evaluation_{N}.md`
4. Proposes systemic improvements
5. Updates cycle_metadata.json

**Report Contents:**
- Aggregate statistics (success rate, avg duration, etc.)
- Pattern analysis (recurring issues, tool effectiveness)
- Prompt evolution analysis (what edits helped/hurt)
- Systemic improvement recommendations
- Action items for next 10 cycles

**Storage:**
- Report stored in: `AI Files/10_cycle_evaluation_{N}.md`
- Summary added to: `cycle_metadata.json ‚Üí evaluations[]`
- Key findings added to MCP memory for future reference

---

## üõ†Ô∏è Maintenance

### Cleanup Tasks

**Weekly:**
- Archive completed sessions to `archive/` folder
- Prune old backups in `old_versions/` (keep last 50)

**Monthly:**
- Review prompt_edit_log.jsonl for patterns
- Update schemas if structure changes
- Compress old evaluation reports

### Version Management

All JSON files include `version` field using semantic versioning (MAJOR.MINOR.PATCH):

- **MAJOR:** Breaking changes to structure
- **MINOR:** New optional fields added
- **PATCH:** Documentation or format fixes

**Current Versions:**
- Schemas: 1.0.0
- Agent prompts: 1.0.0

### Agent Version Synchronization

Full Auto agent validates versions at startup:
- Reads version from each agent prompt YAML frontmatter
- Compares to expected versions
- Alerts user if mismatch detected
- Blocks execution until versions aligned

---

## üìù Usage Guidelines

### For Users

1. **Starting a new task:**
   - Run Full Auto agent with your goal
   - Respond to QA survey if prompted
   - Review plan_output.json before execution begins

2. **Monitoring progress:**
   - Check execution_state.json for current step
   - Review observations in MCP memory
   - Watch prompt_edit_log.jsonl for system improvements

3. **Understanding system evolution:**
   - Read 10_cycle_evaluation reports to see patterns
   - Review prompt_edit_log to see how agents improved
   - Check cycle_metadata to track overall progress

### For Developers

1. **Adding new observation types:**
   - Update MCP memory schema
   - Document in this README
   - Update Smart Execute/Review agents

2. **Modifying tracking files:**
   - Update schema in `schemas/` first
   - Bump version number (MAJOR if breaking)
   - Update all agents that read/write this file
   - Test migration from old format

3. **Adding new agents:**
   - Create .agent.md file with YAML frontmatter
   - Add version field matching other agents
   - Update Full Auto orchestrator to include new agent
   - Add to `edited_agent` enum in prompt_edit_log schema

---

## üö® Critical Rules

1. **NEVER edit prompt_edit_log.jsonl except by appending**
   - This is an immutable audit trail
   - Only append new lines, never modify existing

2. **Smart Execute NEVER edits Smart Execute.agent.md**
   - Prevents self-modification loops
   - Smart Review completes the update cycle by editing Execute

3. **QA Survey always starts with AI improvement question**
   - Question 1: "How can the AI work better?"
   - Ensures continuous system improvement feedback

4. **Version validation before execution**
   - Full Auto checks all agent versions match
   - Prevents incompatible agent combinations

5. **Cycle evaluations MUST occur every 10 cycles**
   - Non-negotiable system health check
   - Prevents drift and degradation

---

## üîó Related Documentation

- **Agent Prompts:** Parent directory (`../`)
  - Smart Plan.agent.md
  - Smart Execute.agent.md
  - Smart Review.agent.md
  - Full Auto.agent.md
- **AutoGen Docs:** `../../docs/`
- **MCP Documentation:** Check Docker MCP server docs

---

**Questions?** Check the agent prompts for detailed workflows and instructions.
